---
import BlogCard from "@/components/BlogCard.astro";
import ImageMod from "@/components/ImageMod.astro";
import Base from "@/layouts/Base.astro";
import { getListPage, getSinglePage } from "@/lib/contentParser.astro";
import { sortByDate } from "@/lib/utils/sortFunctions";
import { markdownify } from "@/lib/utils/textConverter";
import { render } from "astro:content";

const BLOG_FOLDER = "blog";
const about = await getListPage("about", "-index");
const posts = await getSinglePage(BLOG_FOLDER);
const sortedPosts = sortByDate(posts);
const recentPosts = sortedPosts.slice(0, 3);

// Get author content for about section
const authors = await getSinglePage("authors");
const jackNorrie = authors.find(author => author.id === "jack-norrie");
const { Content: AuthorContent } = jackNorrie ? await render(jackNorrie) : { Content: null };
---

<Base
  title="Jack Norrie"
  meta_title="Jack Norrie - Machine Learning Engineer"
  description="Senior Machine Learning Engineer specializing in developing sophisticated machine learning systems and deploying them at scale."
>
  <!-- About Section -->
  <section class="pt-14 pb-0">
    <div class="container">
      <div class="row items-center justify-between">
        <div class="mb:md-0 mb-6 md:col-5">
          <ImageMod
            src="/images/avatar.png"
            height={400}
            width={400}
            alt="Jack Norrie"
            format="webp"
            class="rounded-lg"
          />
        </div>
        <div class="md:col-7 lg:col-6">
          <h1 class="mb-4">About Me</h1>
          <div class="content">
            {AuthorContent && <AuthorContent />}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Recent Posts Section -->
  <section class="pt-14 pb-14 bg-theme-light dark:bg-darkmode-theme-light">
    <div class="container">
      <div class="row mb-8">
        <div class="col-12">
          <h2 class="mb-4">Recent Posts</h2>
        </div>
      </div>
      <div class="row">
        {
          recentPosts.map((post) => (
            <div class="mb-8 md:col-4">
              <BlogCard data={post} />
            </div>
          ))
        }
      </div>
      <div class="row">
        <div class="col-12 text-center">
          <a class="btn btn-outline-primary" href="/blog">View All Posts</a>
        </div>
      </div>
    </div>
  </section>
</Base>
